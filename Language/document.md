# Chiba-lang

<!-- START doctoc generated TOC please keep comment here to allow auto update -->
<!-- DON'T EDIT THIS SECTION, INSTEAD RE-RUN doctoc TO UPDATE -->


- [コンセプト](#コンセプト)
  - [概要](#概要)
  - [記述例](#記述例)
- [データ型](#データ型)
  - [数値型](#数値型) 
  - [文字列型](#文字列型)
  - [論理型](#論理型)
  - [範囲型](#範囲型)
  - [配列型](#配列型)
- [演算子](#演算子)
  - [代入演算子](#代入演算子)
  - [パイプライン演算子](#パイプライン演算子)
  - [チルダ演算子](#チルダ演算子)
  - [ラムダ演算子](#ラムダ演算子)
  - [算術演算子](#算術演算子)
  - [比較演算子](#比較演算子)
  - [論理演算子](#論理演算子)
- [関数](#関数)
- [Scratchとの機能比較](#Scratchとの機能比較)
  - [動き](#動き)
    - [walkメソッド](#walkメソッド)
    - [moveメソッド](#moveメソッド)
    - [stepメソッド](#stepメソッド)
    - [turnメソッド](#turnメソッド)
    - [xメソッド](#xメソッド)
    - [yメソッド](#yメソッド)
  - [見た目](#見た目)
    - [sayメソッド](#sayメソッド) 
    - [costumeメソッド](#costumeメソッド)
    - [backgroundメソッド](#backgroundメソッド)
    - [sizeメソッド](#sizeメソッド)
  - [イベント](#イベント)
    - [thenメソッド](#thenメソッド)
- [](#)
<!-- END doctoc generated TOC please keep comment here to allow auto update -->

## コンセプト
### 概要
　Chiba-langは，Scratchからテキストプログラミング言語への移行時の差異の大きさを軽減することを目的としたプログラミング言語である．小学校でScratchを利用したプログラミング学習を行なった次の段階で使用されることを想定している．Chiba-langは，主にScratchの機能をベースに作成されており，実行環境もScratchと類似したものになると考えられる．以下に，Chiba-langのコンセプトをまとめる．
 1. Scratchのようにスプライトを動かすことで，プログラミングを行う．
 2. 中学生が使うことを想定し，中学生でもわかりやすい英単語を使用する．
 3. ソースコードを見返したとき，上から下，左から右へと処理の流れがわかりやすい文法にする．
 4. C言語のinclude文のような「おまじない」と呼ばれるような要素を作らない．
 5. Scratchと同様に，Webブラウザ上での動作を想定する．
 
### 記述例
```
Splite.new -> cat;
(1~10).each (i) => {
  cat.x + i |> cat.x;
}
```
1行目の`Splite.new -> cat;`では，スプライトの生成を行なっている．例ではcatという変数名のスプライトを生成している．<br>
2行目の`(1~10).each`は，each文で繰り返し処理を表している．例では10回繰り返し処理を行う．<br>
2行目から4行目の`(i) => { cat.x + i |> cat.x }`は，ラムダ式でeach文で繰り返す処理を記述している．例では，cat.xはスプライトのx軸の値を表しており，x軸の値にiを加算する処理を10回行う．<br>

## データ型
処理する値や変数に格納するオペランドのデータ型について記述する．

### 数値型 
```
1 //正の整数
-5 //負の整数
1.5 //浮動小数点数
```
整数と浮動小数点数は以上のように記述する．

### 文字列型
```
"Hello World!!"
'Hello World!!'
```
文字列は，ダブルクォート(")，またはシングルクォート(')で囲む．

### 論理型
```
true
false
```
論理値は，trueまたはfalseで表される．

### 範囲型
```
1~5 //[1,2,3,4,5]と同義
10~6 //[10,9,8,7,6]と同義
```
範囲型はチルダ演算子(~)を使用して表される．範囲型は数値の開始値と終端値を持つ．each文の繰り返し回数を表すときに使用される．

使用例
```
0 -> sum;
(1~10).each (i)=>{
  sum + i -> sum;
}
```

### 配列型
```
[1,2,3,4,5]
["a","b","c"]
```
配列は，複数の値を角括弧([])の中でカンマ(,)で区切ることで表される．

## 演算子
### 代入演算子
```
123 -> num;
"Hello World" -> str;
```
代入演算子は，記号(->)で表される．記号の左側の値を右側の変数に格納する．

### パイプライン演算子
```
"Hello, world" |> console;
5 |> func1 |> func2;
```
パイプライン演算子は，記号(|>)で表される．記号の左側の値を右側の関数や式の引数として実行する．パイプライン演算子を連続で実行する場合，左から優先的に実行される．また，以下のような記述も上記のプログラム例と同様の処理を行う．
```
console "Hello, world";
```
### チルダ演算子
```
1~10;
10 -> start;
start~10;
```
チルダ演算子は，記号(~)で表される．記号の左側の数値を開始値，右側の数値を終端値として範囲型の値を生成する．

### 算術演算子
```
10 + 10; //結果:20
10 - 10; //結果:0
10 * 10; //結果:100
10 / 10; //結果:1
10 % 4; //結果:2
```
算術演算子は，数値型の値を用いて算術演算を実行する．算術演算子の一覧を以下に示す．

|演算子|名称|
|:---:|:---:|
|+|加算演算子|
|-|減算演算子|
|*|乗算演算子|
|/|除算演算子|
|%|剰余演算子|
### 比較演算子
```
10 = 10;
100 > 10;
10 < 100;
100 >= 10;
10 <= 100
```
比較演算子は，二つの値の比較を行い，結果としてブール値(true,false)を返す．比較演算子の一覧を以下に示す．
|演算子|名称|
|:---:|:---:|
|=|等価演算子|
|>|大なり演算子|
|<|小なり演算子|
|>=|以上演算子|
|<=|以下演算子|

### 論理演算子
```
true and false;
true or false;
```
論理演算子は，ブール値(true,false)に対して演算を行う．論理演算子の一覧を以下に示す．
|演算子|名称|
|:---:|:---:|
|and|AND演算子|
|or|OR演算子|

## 関数
```
//引数あり
(arg1, arg2) => {
  return arg1 + arg2
} -> add;
//引数なし
() => {
}
//関数の実行
{ 1, 2 } |> add;
```
関数の宣言は，ラムダ式で表される．`()`の中身には関数の引数が，`{}`の中身には関数の行う処理が記述される．引数がない場合は`()`の中身が空になる．<br>
また，関数には戻り値を指定することができ，`return`で表される．<br>
宣言した関数を実行する場合は，パイプライン演算子`|>`を用いて行う．引数を`{}`で囲み`,`区切りで記述する．

```
//連続した関数の実行
(arg1, arg2) => {
} -> func1;

(arg3) => {
} -> func2;

{ 1, 2 } |> func1 |> func2;
```
パイプライン演算子を使用することで，連続した関数の実行が左から右へと読みやすくなる．

## Scratchとの機能比較
本言語は，Scratchの機能をベースに設計を行なっている．そのため，Scratchとの類似する機能が多々ある．しかし，現時点では，Scratchの機能を全て再現することは考えておらず，必要最低限の機能の実装を想定している．

### スプライトやステージ
![splite_and_stage](images/splite_and_stage.png)
```
Splite.new -> cat;
Stage.new -> stage;
```
Scratchにおいて，スプライトとステージはデフォルトで配置されている．しかし，本言語では，スプライトとステージの生成が必要となる．`Splite.new`でスプライトの生成，`Stage.new`でステージの生成を行う．スプライトは複数生成することができるが，ステージは複数生成することはできない．スプライトとステージはそれぞれ，以下のオプショナルパラメータを指定することができる．

◆スプライト
|オプショナルパラメータ|内容|
|:----------------:|:---:|
|name|名前|
|x|x座標|
|y|y座標|
|size|大きさ|
|deg|角度|
|show|表示|

### 動き
Scratchにおける「動き」に関連するブロックとの類似機能について記述する．

#### walkメソッド
![walk](images/walk.png)
```
Splite.new -> cat;
cat.walk 10;
```
`スプライト名.walk`でスプライトの向いてる方向へ，指定した数値の距離を移動する．

#### moveメソッド
![move_x_y](images/move_x_y.png)<br>
![move_x_y_time](images/move_x_y_time.png)<br>
![move_x](images/move_x.png)<br>
![move_y](images/move_y.png)
```
Splite.new -> cat;
cat.move x:10, y:10;
cat.move x:10, y:10, time:2;
cat.move x:10;
cat.move y:10;
```
`スプライト名.move`でスプライトの座標を指定する移動を行う．オプショナルパラメータにより，変更する要素を指定する．`x:数値`で，x座標を変更する．`y:数値`でy座標を変更する．`time:数値`で変更前の座標から変更後の座標へ移動にかける時間を変更する．指定していない場合は0秒なので，瞬間的な移動を行う．

#### move_stepメソッド
![step_x](images/step_x.png)<br>
![step_y](images/step_y.png)
```
Splite.new -> cat;
cat.move_step x:10;
cat.move_step y:-10;
```
`スプライト名.move_step`でスプライトの元座標に対して指定した数値分の変更を行う．オプショナルパラメータにより，変更する要素を指定する．`x:数値`でx座標に対する変化量を与える．`y;数値`でy座標に対する変化量を与える．`x:10`や`y:-10`のように正負の値どちらも指定することができる．

#### turnメソッド
![turn_right](images/turn_right.png)<br>
![turn left](images/turn_left.png)<br>
![turn](images/turn.png)
```
Splite.new -> cat;
cat.turn 90;
cat.turn -180;
```
`スプライト名.turn`でスプライトの向きの変更を行う．向きは0度から360度まであり，0度と360度が上向き，90度が右向き，180度が下向き，240度が左向きを表す．`90`や`-180`のように正負の値どちらも指定することができる．

#### xメソッド
![x](images/x.png)
```
Splite.new x:10, y:-10 -> cat;
cat.x -> num_x; //10
```
`スプライト名.x`でスプライトの所持しているx座標の値を呼び出す．

#### yメソッド
![y](images/y.png)
```
Splite.new x:10, y:10 -> cat;
cat.y -> num_y; //-10
```
`スプライト名.y`でスプライトの所持しているx座標の値を呼び出す．

### 見た目
Scratchにおける「見た目」に関連するブロックとの類似機能について記述する．

#### sayメソッド
![say](images/say.png)<br>
![say_time](images/say_time.png)<br>
![think](images/think.png)<br>
![think_time](images/think_time.png)
```
Splite.new -> cat;
cat.say "こんにちは"
//表示時間指定
cat.say "こんにちは!";
{ 3.second }.wait; //3秒待つ
cat.say "";
```
`スプライト名.say`でスプライトの上部に吹き出しを表示する．台詞の内容の指定することができる．Scratchにおける「〜と言う」と「〜と考える」ブロックにあたる．また，原則sayメソッドは実行してから上書きしない場合，吹き出しが表示し続ける．そのため，経過時間で吹き出しを消去したい場合は，`スプライト名.say "";`のように文字列を入力しないことで消去する．

#### costumeメソッド
![costume](images/wear.png)<br>
![next_costume](images/next_wear.png)
```
Splite.new -> cat;
cat.costume "コスチューム1";
cat.next_costume;
```
`スプライト名.costume`でスプライトのコスチューム変更を行う．また，`スプライト名.next_costume`で次のコスチュームに変更する．コスチュームはそれぞれ，番号と名前を持っており，wearメソッドではどちらでも指定することができる．

#### backgroundメソッド
![background](images/set.png)<br>
![next_background](images/next_set.png)
```
Stage.new -> stage;
stage.background "背景1";
stage.next_background;
```

`ステージ名.background`でステージの背景の変更を行う．また，`ステージ名.next_background`で次の背景に変更する．背景はそれぞれ，番号と名前を持っており，setメソッドではどちらでも指定することができる．

#### sizeメソッド
![size](images/size.png)
```
Splite.new -> cat;
cat.size 150;
```

`スプライト名.size`でスプライトの大きさの変更を行う．初期値は100．

### イベント
### 制御
### 調べる
### 演算
